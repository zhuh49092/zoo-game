<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>å¤¢è¦‹ãƒ¶å´å‹•ç‰©å‹‡è€…å›£ï½œãƒãƒƒãƒ—</title>
  <link rel="stylesheet" href="assets/style.css" />
  <style>
    /* ä»…é¡µé¢ç‰¹æœ‰çš„å°å·®å¼‚ä¿ç•™åœ¨è¿™é‡Œï¼ˆå›¾æ ‡ç´ æè·¯å¾„ç­‰ï¼‰ */
    .pin-forest{ background-image:url('assets/icons/chest_forest.png'); }
    .pin-grass { background-image:url('assets/icons/chest_grass.png'); }
    .pin-water { background-image:url('assets/icons/chest_water.png'); }
    .pin-scroll{ background-image:url('assets/icons/scroll.png'); }
  </style>
</head>
<body class="page" style="background:#fef9f1">
  <!-- å·¦ä¾§æµ®åŠ¨å¿«æ·æŒ‰é’®ï¼ˆå±‚çº§ < è’™å±‚ï¼‰ -->
  <nav class="floating-nav" aria-label="ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ">
    <a href="spirit.html" aria-label="ç²¾éœŠã‚»ãƒ³ã‚¿ãƒ¼"><img src="assets/ui/btn_spirit.png" alt="ç²¾éœŠã‚»ãƒ³ã‚¿ãƒ¼"></a>
    <a href="https://padlet.com/dchen85/zoo-padlet-l71381k577vyh6xb" target="_blank" rel="noopener" aria-label="å®ç‰©ãƒ›ãƒ¼ãƒ«ï¼ˆPadletï¼‰"><img src="assets/ui/btn_padlet.png" alt="å®ç‰©ãƒ›ãƒ¼ãƒ«"></a>
  </nav>

  <main class="stage-fluid" id="mapStage">
    <!-- åœ°å›¾åº•å›¾ï¼ˆè·Ÿèˆå°åŒä¸€å®¹å™¨ï¼‰ -->
    <img src="assets/map.jpg" alt="Map" class="fill-cover" id="mapImg">

    <!-- å·è½´ï¼šæ´»åŠ¨ä¸­å¿ƒ Padlet -->
    <a class="pin pin-scroll" style="left:76%; top:11%;" href="https://padlet.com/zhuh49092/padlet-g0d3l1jnxdv42n5q" target="_blank" rel="noopener noreferrer" title="ã‚¤ãƒ™ãƒ³ãƒˆæ²ç¤ºæ¿ï¼ˆPadletï¼‰"></a>

    <!-- å®ç®±å…¥å£ï¼ˆé“¾æ¥åˆ°å„ Google Formï¼Œé¢„å¡« UIDï¼‰ -->
    <a class="pin pin-water"  style="left:30%; top:27%;" href="#" onclick="openChest('water')"  title="æ°´è¾º"></a>
    <a class="pin pin-grass"  style="left:60%; top:24%;" href="#" onclick="openChest('grass')"  title="è‰åŸ"></a>
    <a class="pin pin-grass"  style="left:50%; top:46%;" href="#" onclick="openChest('grass')"  title="è‰åŸ"></a>
    <a class="pin pin-forest" style="left:50%; top:10%;" href="#" onclick="openChest('forest')" title="æ£®æ—"></a>
    <a class="pin pin-forest" style="left:82%; top:31%;" href="#" onclick="openChest('forest')" title="æ£®æ—"></a>
    <a class="pin pin-forest" style="left:30%; top:65%;" href="#" onclick="openChest('forest')" title="æ£®æ—"></a>

    <!-- ğŸ”° æŒ‡å¼•è’™å±‚ï¼ˆä¸åœ°å›¾åŒå®¹å™¨ + å±‚çº§æœ€é«˜ï¼‰ -->
    <section class="guide-layer" id="guide-index" aria-hidden="true">
      <img id="guide-index-img" alt="guide">
      <button class="guide-skip" id="guide-index-skip">ã‚¹ã‚­ãƒƒãƒ—</button>
    </section>
  </main>

  <script>
    /* ç™»å½•æ ¡éªŒï¼ˆæ²¿ç”¨ä½ çš„ keyï¼‰ */
    const KEY_UID = 'zooUserId';
    (function requireLogin(){ const uid = localStorage.getItem(KEY_UID); if (!uid) { location.href = 'register.html'; } })();

    /* Google Forms é¢„å¡« UIDï¼ˆæŒ‰ä½ ä¹‹å‰çš„ç»“æ„ï¼‰ */
    const GOOGLE_FORMS = {
      forest: 'https://docs.google.com/forms/d/e/1FAIpQLSe-umCP58ragoaZpKCY7DI-4GkAK1GD9bXNpGb3uwuAKyVKIQ/viewform',
      water:  'https://docs.google.com/forms/d/e/1FAIpQLSehivQhizS3siNa_MnVH_NPTTpDhoco8n5-Mk09gTzeXQispQ/viewform',
      grass:  'https://docs.google.com/forms/d/e/1FAIpQLSf3xBbuJN6RPEa9qworZ_sGwDJnGJ6F6eeE5R9BVZVGqBxU7Q/viewform'
    };
    const USERID_ENTRY_IDS = { forest: 'entry.112735564', water: 'entry.1623179609', grass: 'entry.684988275' };
    function getUserId(){ return (localStorage.getItem(KEY_UID) || '').trim(); }
    function buildPrefilledUrl(type) {
      const base = GOOGLE_FORMS[type]; if (!base) return '';
      const entryId = USERID_ENTRY_IDS[type]; const uid = getUserId();
      if (!entryId || !uid) return base;
      const sep = base.includes('?') ? '&' : '?';
      return `${base}${sep}${encodeURIComponent(entryId)}=${encodeURIComponent(uid)}`;
    }
    function openChest(type){
      const url = buildPrefilledUrl(type);
      if(!url){ alert('ã“ã®å®ç®±ã®ãƒ•ã‚©ãƒ¼ãƒ  URL ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“'); return; }
      window.location.href = url;
    }

    /* æ–°æ‰‹æŒ‡å¼•ï¼šä»…é¦–æ¬¡ï¼›?tour=1 å¼ºåˆ¶æ˜¾ç¤ºï¼›ç‰ˆæœ¬å· v6 */
    (function(){
      const steps=[
        'assets/guide/index/step-1.png',
        'assets/guide/index/step-2.png',
        'assets/guide/index/step-3.png',
        'assets/guide/index/step-4.png'
      ];
      const KEY='guide:index:v6';
      const force=new URLSearchParams(location.search).has('tour');
      const seen=localStorage.getItem(KEY)==='1';
      if(seen && !force) return;

      const wrap=document.getElementById('guide-index');
      const img=document.getElementById('guide-index-img');
      const skip=document.getElementById('guide-index-skip');
      let i=0;

      function showStep(n){ img.src=steps[n]; }
      function closeGuide(){
        wrap.classList.remove('show');
        wrap.setAttribute('aria-hidden','true');
      }
      function next(){
        i++;
        if(i<steps.length){ showStep(i); }
        else { try{ localStorage.setItem(KEY,'1'); }catch(e){} closeGuide(); }
      }

      wrap.addEventListener('click', next);
      skip.addEventListener('click', e=>{ e.stopPropagation(); try{ localStorage.setItem(KEY,'1'); }catch(e){} closeGuide(); });

      showStep(0); wrap.classList.add('show'); wrap.setAttribute('aria-hidden','false');
    })();
  </script>
</body>
</html>
